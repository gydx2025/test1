# A股非经营性房地产资产数据收集器

这是一个Python脚本，用于自动获取中国A股全部上市公司2023年末和2024年末的非经营性房地产资产金额数据。

## 功能特性

### 数据收集
- ✅ 获取全部A股上市公司列表
- ✅ 支持多个数据源（东方财富网、新浪财经、巨潮资讯网）
- ✅ 2023年末和2024年末非经营性房地产资产数据
- ✅ 包含行业分类和公司基本信息
- ✅ 智能数据获取和错误处理

### 数据处理
- ✅ 数据清洗（处理缺失值、异常值）
- ✅ 数据去重（基于股票代码）
- ✅ 数据验证（确保数据合理性）
- ✅ 数据格式统一

### 输出功能
- ✅ Excel文件输出，支持多个工作表
- ✅ 原始数据、处理后数据、统计信息
- ✅ 数据格式化和美化
- ✅ 支持文件命名自定义

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 基本使用（处理全部股票）

```bash
python3 astock_real_estate_collector.py
```

### 2. 使用启动脚本

```bash
chmod +x run_collector.sh
./run_collector.sh
```

### 3. 在脚本中调用

```python
from astock_real_estate_collector import AStockRealEstateDataCollector

# 创建收集器
collector = AStockRealEstateDataCollector()

# 执行数据收集（处理全部股票）
output_file = collector.run()

# 或者限制处理数量（用于测试）
output_file = collector.run(max_stocks=100)  # 只处理前100只股票
```

## 输出文件

脚本会生成Excel文件，包含以下工作表：

### 1. 原始数据
- 包含从各个数据源获取的原始数据
- 字段：股票代码、股票名称、2023年数据、2024年数据、行业、市场

### 2. 处理后数据
- 经过清洗和验证的数据
- 字段：
  - 股票代码
  - 股票名称
  - 2023年末非经营性房地产资产(元)
  - 2024年末非经营性房地产资产(元)
  - 资产变化(元)
  - 变化率(%)
  - 行业分类
  - 市场

### 3. 数据统计
- 总股票数量
- 有非经营性房地产资产的公司数量统计
- 资产总额统计
- 平均资产统计

## 配置说明

### 数据源配置
脚本按照以下优先级尝试获取数据：
1. 东方财富网 (eastmoney.com)
2. 新浪财经 (sina.com)  
3. 巨潮资讯网 (cninfo.com.cn)

### 请求配置
- 请求超时：15-30秒
- 请求间隔：0.5秒（避免频率限制）
- User-Agent：浏览器标识

### 错误处理
- 网络请求失败自动重试下一个数据源
- 单个股票获取失败不影响整体流程
- 详细的日志记录便于问题排查

## 数据清洗规则

1. **数据验证**
   - 排除无股票代码或名称的记录
   - 数值类型转换和范围检查

2. **去重处理**
   - 基于股票代码去重
   - 保留首次出现的记录

3. **数据清洗**
   - 负值置为0
   - 缺失值填充为0
   - 数值精度处理

## 日志级别

- INFO：程序运行状态
- WARNING：非致命错误
- ERROR：严重错误

## 测试模式

生产使用：
```python
collector.run()  # 处理全部股票
```

测试使用：
```python
collector.run(max_stocks=50)  # 只处理50只股票进行测试
```

## 故障排除

### 常见问题

1. **依赖包安装失败**
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

2. **网络连接问题**
   - 检查网络连接
   - 确认防火墙设置
   - 可能需要配置代理

3. **数据获取失败**
   - 检查数据源网站状态
   - 可能需要更新User-Agent
   - 调整请求频率

4. **Excel文件生成失败**
   - 确认有文件写入权限
   - 检查磁盘空间
   - 关闭可能打开的Excel文件

### 调试模式

修改脚本中的日志级别：
```python
logging.basicConfig(level=logging.DEBUG)
```

## 扩展功能

### 添加新数据源

1. 在`AStockRealEstateDataCollector`类中添加新方法
2. 更新`search_real_estate_data`方法中的数据源列表
3. 实现相应的数据获取逻辑

### 自定义数据字段

修改`search_real_estate_data`方法的返回值结构，更新Excel导出的字段定义。

### 数据验证规则

在`clean_and_validate_data`方法中添加新的验证规则。

## 注意事项

1. **法律合规**：确保数据使用符合相关法律法规
2. **请求频率**：注意请求频率限制，避免对目标网站造成压力
3. **数据准确性**：建议对获取的数据进行人工验证
4. **备份数据**：建议对重要的数据结果进行备份

## 版本信息

- 版本：1.0.0
- Python版本要求：3.7+
- 支持的操作系统：Windows, macOS, Linux